name: "Spice Labs CLI Scan & Upload"
description: "Runs The Spice Labs CLI to index files and upload results."

inputs:
  file_path:
    description: "Path to local files to scan"
    required: false
    default: "."
  spice_pass:
    description: "Spice Pass token"
    required: true
  tag:
    description: "Tag to associate with the scan"
    required: true
  cli_image:
    description: "Docker image for the CLI"
    required: false
    default: "spicelabs/spice-labs-cli:latest"

runs:
  using: "composite"
  steps:
    - name: Run Spice Labs CLI Scan & Upload
      shell: bash
      run: |
        set -euo pipefail

        echo "Starting The Spice Labs CLI scan and upload"

        docker run \
          -v "${{ inputs.file_path }}:/mnt/input:ro" \
          -e SPICE_PASS="${{ inputs.spice_pass }}" \
          "${{ inputs.cli_image }}" \
          --log-level all \
          --input /mnt/input \
          --tag "${{ inputs.tag }}"

        echo "Scan and upload complete"
